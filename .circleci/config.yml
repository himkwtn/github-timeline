version: 2
jobs:
  deploy:
    machine: true
    steps:
      - add_ssh_keys:
          fingerprints:
            - '3d:87:8e:9f:a6:94:27:37:48:ff:6f:76:76:58:6b:72'
      - run:
          name: install dependency
          command: yarn
      - run:
          name: build
          command: yarn build
      - run:
          name: transfer file
          command: ls && scp -r ./build SSH$SSH_USER@$SSH_HOST:~/github-timeline/build-tmp
      - run:
          name: deploy
          command: |
            ssh $SSH_USER@$SSH_HOST "github-timeline && \
            rm -rf build \
            mv build-tmp build"

workflows:
  version: 2
  build-and-deploy:
    jobs:
      - deploy:
          filters:
            branches:
              only:
                - master
